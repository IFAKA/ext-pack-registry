<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>ext-pack Registry - Browser Extension Packs</title>
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, sans-serif;
      line-height: 1.6;
      color: #333;
      background: #f5f5f5;
    }

    .container {
      max-width: 1200px;
      margin: 0 auto;
      padding: 20px;
    }

    header {
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      color: white;
      padding: 60px 20px;
      text-align: center;
      margin-bottom: 40px;
      border-radius: 8px;
    }

    h1 {
      font-size: 3em;
      margin-bottom: 10px;
    }

    .subtitle {
      font-size: 1.2em;
      opacity: 0.9;
    }

    .search-box {
      background: white;
      padding: 30px;
      border-radius: 8px;
      box-shadow: 0 2px 10px rgba(0,0,0,0.1);
      margin-bottom: 30px;
    }

    input[type="search"] {
      width: 100%;
      padding: 15px;
      font-size: 1.1em;
      border: 2px solid #ddd;
      border-radius: 6px;
      outline: none;
      transition: border-color 0.3s;
    }

    input[type="search"]:focus {
      border-color: #667eea;
    }

    .filters {
      margin-top: 20px;
      display: flex;
      gap: 10px;
      flex-wrap: wrap;
    }

    .filter-tag {
      padding: 8px 16px;
      background: #f0f0f0;
      border: 1px solid #ddd;
      border-radius: 20px;
      cursor: pointer;
      transition: all 0.2s;
    }

    .filter-tag:hover {
      background: #667eea;
      color: white;
      border-color: #667eea;
    }

    .filter-tag.active {
      background: #667eea;
      color: white;
      border-color: #667eea;
    }

    .stats {
      text-align: center;
      margin-bottom: 30px;
      color: #666;
    }

    .packs-grid {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(350px, 1fr));
      gap: 20px;
      margin-bottom: 40px;
    }

    .pack-card {
      background: white;
      border-radius: 8px;
      padding: 25px;
      box-shadow: 0 2px 10px rgba(0,0,0,0.1);
      transition: transform 0.2s, box-shadow 0.2s;
    }

    .pack-card:hover {
      transform: translateY(-5px);
      box-shadow: 0 5px 20px rgba(0,0,0,0.15);
    }

    .pack-name {
      font-size: 1.5em;
      font-weight: bold;
      margin-bottom: 10px;
      color: #667eea;
    }

    .pack-description {
      color: #666;
      margin-bottom: 15px;
    }

    .pack-meta {
      display: flex;
      gap: 15px;
      margin-bottom: 15px;
      font-size: 0.9em;
      color: #999;
    }

    .pack-meta span {
      display: flex;
      align-items: center;
      gap: 5px;
    }

    .pack-tags {
      display: flex;
      gap: 5px;
      flex-wrap: wrap;
      margin-bottom: 15px;
    }

    .tag {
      padding: 4px 10px;
      background: #f0f0f0;
      border-radius: 12px;
      font-size: 0.85em;
      color: #666;
    }

    .install-cmd {
      background: #f8f8f8;
      padding: 10px;
      border-radius: 4px;
      font-family: 'Courier New', monospace;
      font-size: 0.9em;
      color: #667eea;
      cursor: pointer;
      user-select: all;
    }

    .install-cmd:hover {
      background: #efefef;
    }

    .no-results {
      text-align: center;
      padding: 60px 20px;
      color: #999;
    }

    footer {
      text-align: center;
      padding: 40px 20px;
      color: #999;
      border-top: 1px solid #ddd;
    }

    .loading {
      text-align: center;
      padding: 60px 20px;
      color: #999;
    }
  </style>
</head>
<body>
  <div class="container">
    <header>
      <h1>üì¶ ext-pack Registry</h1>
      <p class="subtitle">Discover and install browser extension packs</p>
    </header>

    <div class="search-box">
      <input
        type="search"
        id="search"
        placeholder="Search packs..."
        autocomplete="off"
      />
      <div class="filters" id="filters"></div>
    </div>

    <div class="stats" id="stats">
      <span id="pack-count">Loading...</span>
    </div>

    <div class="packs-grid" id="packs">
      <div class="loading">Loading packs...</div>
    </div>

    <footer>
      <p>
        <strong>ext-pack</strong> - The npm for browser extensions<br>
        <a href="https://github.com/IFAKA/ext-pack">GitHub</a> ‚Ä¢
        <a href="https://github.com/ext-pack/registry">Registry</a>
      </p>
    </footer>
  </div>

  <script>
    let allPacks = [];
    let currentFilter = null;

    // Fetch registry data
    fetch('../registry.json')
      .then(r => r.json())
      .then(data => {
        allPacks = Object.values(data.packs);
        renderStats();
        renderFilters();
        renderPacks(allPacks);
      })
      .catch(err => {
        document.getElementById('packs').innerHTML =
          '<div class="no-results">Failed to load registry. Try refreshing the page.</div>';
      });

    // Search functionality
    document.getElementById('search').addEventListener('input', (e) => {
      const query = e.target.value.toLowerCase();
      filterPacks(query, currentFilter);
    });

    function filterPacks(query, tag) {
      let filtered = allPacks;

      // Filter by search query
      if (query) {
        filtered = filtered.filter(pack =>
          pack.name.toLowerCase().includes(query) ||
          pack.description.toLowerCase().includes(query) ||
          pack.author?.name?.toLowerCase().includes(query)
        );
      }

      // Filter by tag
      if (tag) {
        filtered = filtered.filter(pack =>
          pack.tags && pack.tags.includes(tag)
        );
      }

      renderPacks(filtered);
    }

    function renderStats() {
      const count = allPacks.length;
      const totalDownloads = allPacks.reduce((sum, p) => sum + (p.downloads || 0), 0);
      document.getElementById('pack-count').textContent =
        `${count} pack${count !== 1 ? 's' : ''} ‚Ä¢ ${totalDownloads.toLocaleString()} total downloads`;
    }

    function renderFilters() {
      const tags = new Set();
      allPacks.forEach(pack => {
        if (pack.tags) {
          pack.tags.forEach(tag => tags.add(tag));
        }
      });

      const filtersEl = document.getElementById('filters');
      Array.from(tags).sort().forEach(tag => {
        const btn = document.createElement('button');
        btn.className = 'filter-tag';
        btn.textContent = `#${tag}`;
        btn.onclick = () => {
          currentFilter = currentFilter === tag ? null : tag;
          document.querySelectorAll('.filter-tag').forEach(b =>
            b.classList.toggle('active', b.textContent === `#${tag}` && currentFilter === tag)
          );
          const query = document.getElementById('search').value.toLowerCase();
          filterPacks(query, currentFilter);
        };
        filtersEl.appendChild(btn);
      });
    }

    function renderPacks(packs) {
      const container = document.getElementById('packs');

      if (packs.length === 0) {
        container.innerHTML = '<div class="no-results">No packs found. Try a different search.</div>';
        return;
      }

      // Sort by downloads
      packs.sort((a, b) => (b.downloads || 0) - (a.downloads || 0));

      container.innerHTML = packs.map(pack => `
        <div class="pack-card">
          <div class="pack-name">${escapeHtml(pack.name)}</div>
          <div class="pack-description">${escapeHtml(pack.description || 'No description')}</div>

          <div class="pack-meta">
            <span>üì¶ ${pack.extensions} ext${pack.extensions !== 1 ? 's' : ''}</span>
            <span>‚Üì ${(pack.downloads || 0).toLocaleString()}</span>
            <span>‚≠ê ${pack.stars || 0}</span>
          </div>

          ${pack.tags && pack.tags.length > 0 ? `
            <div class="pack-tags">
              ${pack.tags.map(tag => `<span class="tag">#${tag}</span>`).join('')}
            </div>
          ` : ''}

          <div class="install-cmd" onclick="copyToClipboard(this)" title="Click to copy">
            ext-pack install ${pack.id}
          </div>
        </div>
      `).join('');
    }

    function escapeHtml(text) {
      const div = document.createElement('div');
      div.textContent = text;
      return div.innerHTML;
    }

    function copyToClipboard(el) {
      navigator.clipboard.writeText(el.textContent).then(() => {
        const original = el.textContent;
        el.textContent = '‚úì Copied!';
        setTimeout(() => {
          el.textContent = original;
        }, 1500);
      });
    }
  </script>
</body>
</html>
